import{r as m,a as p,j as e,H as j,B as d,s as r,L as u}from"./app-oKcMah4B.js";import{A as b}from"./AppLayout-BkjjBjrr.js";import{S as y}from"./separator-D-mlPY_S.js";import{D as N}from"./DataTable-Ce7i-V-n.js";import{R as S}from"./status-badges-Dwtx-k_E.js";import{P as w}from"./plus-BGGo3CBK.js";import{E as h}from"./eye-B56zDxbF.js";/* empty css            */import"./sun-BNKJhPB7.js";import"./input-pKAWPIMY.js";import"./popover-B3yyS8N8.js";import"./badge-B5R7UOFY.js";import"./select-IWh58R8R.js";function L({isAdmin:g}){const i=m.useRef(null),{toast:n}=p(),[o,c]=m.useState(!1),x=async()=>{c(!0);try{const s=await fetch(r("registrations.issue"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to issue number");n({title:"Success",description:`Registration number ${t.number} has been issued successfully.`}),setTimeout(()=>{i.current?.reload()},100)}catch(s){console.error("Issue number error:",s),n({variant:"destructive",title:"Error",description:s.message||"Failed to issue registration number. Please try again."})}finally{c(!1)}},f=[{accessorKey:"number",header:"Registration Number",cell:({row:s})=>e.jsx("div",{className:"font-mono font-medium text-sm",children:s.getValue("number")})},{accessorKey:"issued_to",header:"Issued To",cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"text-sm",children:t.issued_to?e.jsx("span",{className:"font-medium",children:t.issued_to.name}):e.jsx("span",{className:"text-muted-foreground italic",children:"Unknown User"})})},enableSorting:!1},{accessorKey:"state",header:"State",cell:({row:s})=>{const t=s.getValue("state");return e.jsx(S,{state:t})},enableSorting:!1},{accessorKey:"documents",header:"Documents",cell:({row:s})=>{const t=s.original,a=Array.isArray(t.documents)?t.documents:[];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[a.length," / 2"]}),a.length>0&&e.jsx("div",{className:"flex gap-1",children:a.map(l=>e.jsx(u,{href:r("documents.show",l.id),className:"text-xs text-primary hover:underline",children:e.jsx(h,{className:"h-3 w-3"})},l.id))})]})},enableSorting:!1},{accessorKey:"created_at",header:"Issued Date",cell:({row:s})=>{const t=new Date(s.getValue("created_at"));return e.jsx("div",{className:"text-sm",children:t.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"})})}},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(u,{href:r("documents.index",{q:t.number}),children:e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(h,{className:"h-4 w-4"})})})})}}];return e.jsxs(b,{children:[e.jsx(j,{title:"Registrations"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Registrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage registration numbers for documents"})]}),g&&e.jsxs(d,{onClick:x,disabled:o,children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),o?"Issuing...":"Issue Number"]})]}),e.jsx(y,{}),e.jsx(N,{ref:i,columns:f,mode:"yajra",apiUrl:r("registrations.index"),dtColumns:["id","number","year","month","seq","state","issued_to_user_id","created_at","issued_to","documents"],searchPlaceholder:"Search registrations...",emptyMessage:"No registrations found.",showColumnVisibility:!0,showPagination:!0,pageSize:15})]})]})}export{L as default};
